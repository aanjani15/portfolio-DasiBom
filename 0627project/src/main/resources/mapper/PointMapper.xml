<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.booksajo.dasibom.service.dao.PointDAO">

    <!-- 포인트 적립/사용 기록 저장 -->
    <insert id="insertPoint" parameterType="PointVO">
        INSERT INTO point_table (
            point_id,
            user_id,
            point,
            point_date,
            description
        )
        VALUES (
            point_seq.NEXTVAL,
            #{user_Id},
            #{point},
            SYSDATE,
            #{description}
        )
    </insert>

    <!-- 유저 총 포인트 -->
    <select id="getTotalPoint" resultType="int">
        SELECT NVL(SUM(point), 0)
        FROM point_table
        WHERE user_id = #{user_Id}
    </select>

    <!-- 유저 포인트 내역 -->
    <select id="getPointHistory" resultType="PointVO">
        SELECT *
        FROM point_table
        WHERE user_id = #{user_Id}
        ORDER BY point_date DESC
    </select>
    
    <!-- Point update -->
	<update id="updateUserPoint">
	    UPDATE user_table
	    SET point = point + #{point}
	    WHERE user_id = #{user_Id}
	</update>
    

</mapper>
